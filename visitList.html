<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<script src="js/Common.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">入户走访</h1>
		</header>
		
	<div class="mui-content" >
			<div class="mui-content" >
				<div class="mui-card" >
					<div class="mui-card-header">
						<h4 style="font-weight: normal;">
							<span style="font-size: 20px;" class="mui-icon mui-icon-search"></span>
							<span>搜索</span>
						</h4>
					</div>
					<div class="mui-card-content">
						<form class="mui-input-group" >
							<div class="mui-input-row" >
								<label style="width: 30%;" >社区</label>
								<select  style="width: 70%;" id="shequID" class="mui-btn-block" onchange="getXiaoquInfo()" >
								</select>
							</div>
							<div class="mui-input-row">
								<label style="width: 30%;">小区</label>
								<select   style="width: 70%;" class="mui-btn-block" id="communityInfo" onchange="getBuildingInfo()">
								</select>
							</div>
							<div class="mui-input-row">
								<label style="width: 30%;">楼栋</label>
								<select  style="width: 70%;" id="LouDongID" class="mui-btn-block" onchange="getRoomInfo()">
								</select>
							</div>
							<div  class="mui-input-row">
							<label style="width: 30%;">房号</label>
							<select style="width: 70%;" id="FangHaoID" class="mui-btn-block">
							</select>
							</div>
							<div id="mui-input-row">
							<div class="mui-input-row" style="margin: 10px 5px; height: 100%; ">
								<textarea id="memoinfo" rows="6" placeholder="请输入备注信息,或者住户反映的情况"></textarea>
							</div>
							</div>
							
						</form>
					</div>
					<div class="mui-card-footer">
						<div class="mui-button-row" style="margin: 0 auto;">
							<button type="button" id="commitVisitInfo" class="mui-btn mui-btn-primary" >提交</button>&nbsp;&nbsp;
						</div>
					</div>
				</div>
		
		
		
		<script src="js/mui.min.js"></script>
		
		<script type="text/javascript">
			
			mui.init({

				beforeback: function(){
					//获得列表界面的webview
					var list = plus.webview.getWebviewById('tab-webview-subpage-about.html');
					//触发列表界面的自定义事件（refresh）,从而进行数据刷新
					mui.fire(list,'getindex');
					//返回true，继续页面关闭逻辑
					return true;
				}
			});
			
			document.getElementById("commitVisitInfo").addEventListener('tap',function(){
			
				var visitdate = new Date().valueOf();
				var shequid = document.getElementById("shequID").value;
				var xiaoquid = document.getElementById("communityInfo").value;
				var loudongid = document.getElementById("LouDongID").value;
				var fanghaoid = document.getElementById("FangHaoID").value;
				var memoinfo = document.getElementById("memoinfo").value;
				
				mui.ajax('http://124.117.230.75:8080/app?cmd=addvisitrecord',{
					data:{
						"VisitDate":visitdate,
						"PEO_SQ_ID":shequid,
						"PEO_XQ_ID":xiaoquid,
						"PEO_LD_ID":loudongid,
						"PEO_HS_NUM":fanghaoid,
						"MemoInfo":memoinfo
					},
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					success:function(data){
						if (data.data == '写入成功') {

							mui.toast('添加走访记录成功');
							
						} else{
							
						}
					},
					error:function(xhr,type,errorThrown){
						
					}
				});		
				
			});
				
		</script>
		<!--加载小区 楼栋 房间号信息-->
		<script type="text/javascript">
	//发送请求加载小区数据;
		function getXiaoquInfo(){
				var selected_val = document.getElementById('shequID').value;
				common.getXiaoqu(selected_val,function(result){
					document.getElementById("communityInfo").innerHTML = result;
					getBuildingInfo()
				});
		}
		//发送请求加载楼栋数据
		 function getBuildingInfo(){
				var selected_val = document.getElementById('communityInfo').value;
				common.getLoudong(selected_val,function(result){
					document.getElementById("LouDongID").innerHTML = result;
					getRoomInfo();
				});
		 }
		 //获取房间信息
		 function getRoomInfo(){
		 	var selected_val = document.getElementById('LouDongID').value;
		 	if (selected_val == null || selected_val ==undefined || selected_val == '') {
					mui.toast('请选择楼栋');
				}
				mui.ajax('http://124.117.230.75:8080/app?cmd=gethousebybuildingid&buildingid='+selected_val,{
				dataType:'json',
				type:'get',
				success:function(data){
				var area_name = '<option value="">请选择</option>';
				
				for (i=0;i<data.data.length;i++) {
					
					//加入是否走访的标记
					if (data.data[i].visited.length > 1){
						area_name +=
						'<option style="color: #2AC845;" value="'+
						data.data[i].house_num_id
						+'">'+ data.data[i].house_num+'&nbsp&nbsp本月已走访</option>';
					}else{
							area_name +=
						'<option value="'+
						data.data[i].house_num_id
						+'"> '+ data.data[i].house_num+'</option>';
					}
					
					
					
				}
				document.getElementById("FangHaoID").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){
						
				}
			});
		 }
		
		</script>
		<!--加载社区信息-->
		<script type="text/javascript" >
			mui.plusReady(function () {
   				common.getSheQu(function(result){
				document.getElementById("shequID").innerHTML = result;
				getXiaoquInfo();
			});
		});
		
		</script>
		
	</body>

</html>