<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
			<style type="text/css">
				.yl_txt { font-size: 17px; line-height: 37px; color: #222; }
			</style>
			<style>
			html,
			body {
				
				background-color: #FFFAE8;
			}
			.title {
				padding: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
				background-color: #fff;
			}
		</style>
	</head>
	<body >
		<div class="mui-content" style="background-color: #FFFAE8;">
			<div class="mui-content" style="background-color: #FFFAE8;">
				<div class="mui-card" style="background-color: #FFFAE8;">
					<div class="mui-card-header">
						<h4 style="font-weight: normal;">
							<span style="font-size: 20px;" class="mui-icon mui-icon-search"></span>
							<span>搜索</span>
						</h4>
					</div>
					<div class="mui-card-content">
						<form class="mui-input-group" style="background-color: #FFFAE8;">
							<div class="mui-input-row" >
								<label style="width: 30%;" >社区</label>
								<select style="background-color: #FFFAE8;" style="width: 70%;" id="shequID" class="mui-btn-block" onchange="getXiaoquInfo()" >
								</select>
							</div>
							<div class="mui-input-row">
								<label style="width: 30%;">小区</label>
								<select  style="background-color: #FFFAE8;" style="width: 70%;" class="mui-btn-block" id="communityInfo" onchange="getBuildingInfo()">
								</select>
							</div>
							<div class="mui-input-row">
								<label style="width: 30%;">楼栋</label>
								<select style="background-color: #FFFAE8;" style="width: 70%;" id="LouDongID" class="mui-btn-block" onchange="getRoomInfo()">
								</select>
							</div>
							<div class="mui-input-row">
							<label style="width: 30%;">房号</label>
							<select style="background-color: #FFFAE8;" style="width: 70%;" id="FangHaoID" class="mui-btn-block">
							</select>
							</div>
						</form>
					</div>
					<div class="mui-card-footer">
						<div class="mui-button-row" style="margin: 0 auto;">
							<button type="button" class="mui-btn mui-btn-primary" onclick="searchPersionList()" >搜索</button>&nbsp;&nbsp;
							<button type="button" class="mui-btn mui-btn-danger" onclick="return false;">取消</button>
						</div>
					</div>
				</div>
				
				<div id="personList" class="mui-content">
					
				</div>
					<div class="mui-content-padded" > 
						<a id="from_1">
						<button onclick="addPersion()" style="padding: 10px 0; margin: 16px 0;" type="button" class="mui-btn mui-btn-primary mui-btn-block">
							新增成员
						</button>
						</a>
					</div>	
			</div>
		</div>
		
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/Common.js"></script>	
		<script type="text/javascript" charset="utf-8">
	
		//发送请求加载小区数据;
		function getXiaoquInfo(){
			var selected_val = document.getElementById('shequID').value;
			
				mui.ajax('http://124.117.230.75:8080/app?cmd=getvillagebycommunityid&communityid='+selected_val,{
				dataType:'json',
				type:'get',
				success:function(data){
				var area_name = '<option value="">请选择</option>';
				
				for (i=0;i<data.data.length;i++) {
					area_name += 
					'<option value="'+
					data.data[i].area_id
					+'">'+ data.data[i].area_name+'</option>';
				}
				document.getElementById("communityInfo").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){
						
				}
			});
		}
		
		//发送请求加载楼栋数据
		 function getBuildingInfo(){
				var selected_val = document.getElementById('communityInfo').value;
				mui.ajax('http://124.117.230.75:8080/app?cmd=getbuildingbyvillageid&villageid='+selected_val,{
				dataType:'json',
				type:'get',
				success:function(data){
				var area_name = '<option value="" >请选择</option>';
				for (i=0;i<data.data.length;i++) {
					area_name += 
					'<option value="'+
					data.data[i].area_id
					+'">'+ data.data[i].area_name+'</option>';
				}
				document.getElementById("LouDongID").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){
				}
			});
		 
		 
		 }
		 //获取房间信息
		 function getRoomInfo(){
		 	
		 	var selected_val = document.getElementById('LouDongID').value;
		 	if (selected_val == null || selected_val ==undefined || selected_val == '') {
					mui.toast('请选择楼栋');
				}
				mui.ajax('http://124.117.230.75:8080/app?cmd=gethousebybuildingid&buildingid='+selected_val,{
				dataType:'json',
				type:'get',
				success:function(data){
				var area_name = '<option value="">请选择</option>';
				for (i=0;i<data.data.length;i++) {
					area_name += 
					'<option value="'+
					data.data[i].house_num_id
					+'">'+ data.data[i].house_num+'</option>';
				}
				document.getElementById("FangHaoID").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){
						
				}
			});
		 }
		
			//执行搜索
			function searchPersionList(){
				var selected_val = document.getElementById('FangHaoID').value;
				if (selected_val == null || selected_val ==undefined || selected_val == '') {
					mui.toast('请选择房间号');
					return;
				}
				
				mui.ajax('http://124.117.230.75:8080/app?cmd=getlivepeoplebyhouseid&houseid='+selected_val,{
						dataType:'json',
						type:'get',
						success:function(data){
						var area_name='' ;
						if(data.data.length<1){
							mui.toast('暂无人员');
							//如果没有列表,插入空内容
							document.getElementById("personList").innerHTML = '';
							return;
						}
				for (i=0;i<data.data.length;i++) {
					//判断数据是否为空,如果为空,设置默认值;
					 var name = changeString(data.data[i].peo_name);
					 var sex = changeString(data.data[i].peo_sex);
					 var nation = changeString(data.data[i].peo_nation_id);
					 var relation = changeString(data.data[i].peo_yz_relation);
					 var idcard = changeString(data.data[i].peo_card_num);
					 var jg =changeString(data.data[i].peo_jg_id);
					 var phone =changeString(data.data[i].peo_phone);
					 var birth = changeString(data.data[i].peo_birthday);
					 var username = changeString(data.data[i].czy_username);
					 var names =   changeString(data.data[i].czy_names);
					
					area_name
					+=
					'<div class="mui-card"><div class="mui-card-header"><h4 style="font-weight: normal;"><span style="font-size: 20px;" class="mui-icon mui-icon-map"></span><span>当前住户</span></h4></div><div class="mui-card-content"><form class="mui-input-group"><div class="mui-input-row">'
					+'<label style="width: 35%;">姓名</label><p class="yl_txt">'
					+ name
					+'</p>'+'</div><div class="mui-input-row"><label style="width: 35%;">性别</label>'+'<p class="yl_txt">'
					+sex
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">族别</label><p class="yl_txt">'
					+nation
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">与业主关系</label><p class="yl_txt">'
					+relation
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">身份证</label><p class="yl_txt">'
					+idcard
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">籍贯</label><p class="yl_txt">'
					+jg
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">电话</label><p class="yl_txt">'
					+phone
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">出生日期</label><p class="yl_txt">'
					+birth
					+'</p></div><div class="mui-input-row"><label style="width: 35%;">操作员</label><p class="yl_txt">'
					+username+':'+ names
					+'</p></div></form></div><div class="mui-card-footer"><div class="mui-button-row" style="margin: 0 auto;"><button type="button" class="mui-btn mui-btn-primary mui-btn-outlined" onclick="return false;">修改</button>&nbsp;&nbsp;</div></div></div>'
					;
				}
				//插入数据内容;
				document.getElementById("personList").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){

				}
			});	
		}
			
			
			function changeString(data){
				var result =(data == "" || data == undefined || data == null) ? "暂无" : data;
				return result;
			}
		
			function addPersion(){
					mui.openWindow({
					    url: 'addPerson.html', 
					    id:'addPerson'
				     });
			}
		
		</script>	

	<script>
	mui.plusReady(function(){
			//开启回弹

			var placeholderText = '<option value="">请选择</option>';
			document.getElementById('shequID').innerHTML =placeholderText ;
			document.getElementById('communityInfo').innerHTML =placeholderText ;
			document.getElementById('LouDongID').innerHTML =placeholderText ;
			document.getElementById('FangHaoID').innerHTML =placeholderText ;
			
			//获取社区列表
			mui.ajax('http://124.117.230.75:8080/app?cmd=getcommunitylist',{
				dataType:'json',
				type:'get',
				success:function(data){
				var area_name ='<option value="">请选择</option>';
				
				for (i=0;i<data.data.length;i++) {
					area_name += 
					'<option value="'+
					data.data[i].area_id
					+'">'+ data.data[i].area_name+'</option>';
				}
				
				document.getElementById("shequID").innerHTML = area_name;				
				},
				error: function(xhr,type,errorThrown){
					
				}
			});
			
			
		//点击跳转到新增人员界面
		document.getElementById('from_1').addEventListener('tap',function(){
		});
	});
	</script>
	</body>
</html>